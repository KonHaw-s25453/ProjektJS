<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>VCV Patch Archive - Demo</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 900px; margin: 2rem auto; }
      label, input, select, textarea { display:block; margin: .5rem 0; }
      .patch { border: 1px solid #ddd; padding: .5rem; margin:.5rem 0 }
    </style>
  </head>
  <body>
    <h1>VCV Patch Archive — Demo</h1>

    <section>
      <h2>Upload patch (.vcv)</h2>
      <form id="uploadForm">
        <label>Plik .vcv</label>
        <input type="file" name="vcv" accept=".vcv" required />
        <label>Kategoria</label>
        <input name="category" />
        <label>Użytkownik</label>
        <input name="user" />
        <label>Opis (opcjonalnie)</label>
        <textarea name="description"></textarea>
        <button type="submit">Wyślij</button>
      </form>
      <div id="uploadResult"></div>
    </section>

    <section>
      <h2>Lista patchy</h2>
      <button id="refresh">Odśwież</button>
      <div id="patches"></div>
    </section>

    <script>
      document.getElementById('uploadForm').addEventListener('submit', async e => {
        e.preventDefault();
        const form = e.target;
        const fd = new FormData(form);
        const res = await fetch('/upload', { method: 'POST', body: fd });
        const json = await res.json();
        document.getElementById('uploadResult').innerText = JSON.stringify(json, null, 2);
      });

      async function loadPatches(){
        const res = await fetch('/patches');
        const json = await res.json();
        const container = document.getElementById('patches');
        container.innerHTML = '';
        (json.patches || []).forEach(p => {
          const d = document.createElement('div'); d.className='patch';
          d.innerHTML = `<strong>#${p.id}</strong> ${p.user_name || ''} — ${p.description || ''}<br/>Modules: ${p.module_count || 0}<br/><a href='/download/${p.id}'>Pobierz</a>`;
          container.appendChild(d);
        });
      }
      document.getElementById('refresh').addEventListener('click', loadPatches);
      loadPatches();
    </script>
  </body>
</html>
